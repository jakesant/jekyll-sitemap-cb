<?xml version="1.0" encoding="UTF-8"?>
{% if page.xsl %}
  <?xml-stylesheet type="text/xsl" href="{{ "/sitemap.xsl" | absolute_url }}"?>
{% endif %}
<urlset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd" xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {% for page in site.pages %}
    {% unless page.url == '/404.html' or page.url == '/sitemap.xml' %}
      {% assign url_to_check = page.url | absolute_url %}
      {% if url_to_check.last == '/' and url_to_check != site.url %}
        {% assign last_char_index = url_to_check | size | minus: 1 %}
        {% assign stripped_url = url_to_check | slice: 0, last_char_index %}
      {% else %}
        {% assign stripped_url = url_to_check %}
      {% endif %}
      <url>
        <loc>{{ stripped_url | xml_escape }}</loc>
        {% if page.last_modified_at %}
          <lastmod>{{ page.last_modified_at | date_to_xmlschema }}</lastmod>
        {% else %}
          <lastmod>{{ page.date | date_to_xmlschema }}</lastmod>
        {% endif %}
      </url>
    {% endunless %}
  {% endfor %}
</urlset>
